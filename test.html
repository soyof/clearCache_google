<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>清理缓存助手 - 测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #667eea;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #4a5568;
            margin-top: 0;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a67d8;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        .status.info {
            background: #bee3f8;
            color: #2c5282;
            border: 1px solid #90cdf4;
        }
        .storage-info {
            background: #f7fafc;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧹 清理缓存助手测试页面</h1>
        
        <div class="test-section">
            <h3>📊 当前存储状态</h3>
            <button onclick="checkStorage()">检查存储状态</button>
            <div id="storage-status" class="storage-info"></div>
        </div>
        
        <div class="test-section">
            <h3>💾 LocalStorage 测试</h3>
            <button onclick="addLocalStorage()">添加 LocalStorage 数据</button>
            <button onclick="clearLocalStorage()">清空 LocalStorage</button>
            <div id="localStorage-status" class="status"></div>
        </div>
        
        <div class="test-section">
            <h3>📂 SessionStorage 测试</h3>
            <button onclick="addSessionStorage()">添加 SessionStorage 数据</button>
            <button onclick="clearSessionStorage()">清空 SessionStorage</button>
            <div id="sessionStorage-status" class="status"></div>
        </div>
        
        <div class="test-section">
            <h3>🍪 Cookie 测试</h3>
            <button onclick="addCookies()">添加 Cookie 数据</button>
            <button onclick="clearCookies()">清空 Cookie</button>
            <div id="cookies-status" class="status"></div>
        </div>
        
        <div class="test-section">
            <h3>🗄️ IndexedDB 测试</h3>
            <button onclick="addIndexedDB()">添加 IndexedDB 数据</button>
            <button onclick="clearIndexedDB()">清空 IndexedDB</button>
            <div id="indexedDB-status" class="status"></div>
        </div>
        
        <div class="test-section">
            <h3>📋 Cache API 测试</h3>
            <button onclick="addCacheAPI()">添加 Cache 数据</button>
            <button onclick="clearCacheAPI()">清空 Cache</button>
            <div id="cacheAPI-status" class="status"></div>
        </div>
        
        <div class="test-section">
            <h3>🧹 插件测试</h3>
            <p>安装插件后，点击浏览器工具栏中的插件图标，测试各种清理功能。</p>
            <p><strong>建议测试步骤：</strong></p>
            <ol>
                <li>点击上面的按钮添加各种类型的测试数据</li>
                <li>使用插件的清理功能</li>
                <li>再次点击"检查存储状态"验证清理效果</li>
            </ol>
        </div>
    </div>

    <script>
        // 显示状态消息
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }
        
        // 检查存储状态
        function checkStorage() {
            const status = document.getElementById('storage-status');
            const info = {
                localStorage: {
                    count: localStorage.length,
                    keys: Object.keys(localStorage)
                },
                sessionStorage: {
                    count: sessionStorage.length,
                    keys: Object.keys(sessionStorage)
                },
                cookies: document.cookie.split(';').filter(c => c.trim()).length,
                userAgent: navigator.userAgent.substring(0, 50) + '...'
            };
            
            status.innerHTML = `
                <strong>存储状态：</strong><br>
                LocalStorage: ${info.localStorage.count} 项 [${info.localStorage.keys.join(', ')}]<br>
                SessionStorage: ${info.sessionStorage.count} 项 [${info.sessionStorage.keys.join(', ')}]<br>
                Cookies: ${info.cookies} 项<br>
                User Agent: ${info.userAgent}
            `;
        }
        
        // LocalStorage 测试
        function addLocalStorage() {
            const testData = {
                'test-key-1': 'LocalStorage 测试数据 1',
                'test-key-2': 'LocalStorage 测试数据 2',
                'test-timestamp': new Date().toISOString(),
                'test-number': Math.random().toString()
            };
            
            Object.entries(testData).forEach(([key, value]) => {
                localStorage.setItem(key, value);
            });
            
            showStatus('localStorage-status', `已添加 ${Object.keys(testData).length} 项 LocalStorage 数据`, 'success');
        }
        
        function clearLocalStorage() {
            const count = localStorage.length;
            localStorage.clear();
            showStatus('localStorage-status', `已清空 ${count} 项 LocalStorage 数据`, 'success');
        }
        
        // SessionStorage 测试
        function addSessionStorage() {
            const testData = {
                'session-key-1': 'SessionStorage 测试数据 1',
                'session-key-2': 'SessionStorage 测试数据 2',
                'session-timestamp': new Date().toISOString()
            };
            
            Object.entries(testData).forEach(([key, value]) => {
                sessionStorage.setItem(key, value);
            });
            
            showStatus('sessionStorage-status', `已添加 ${Object.keys(testData).length} 项 SessionStorage 数据`, 'success');
        }
        
        function clearSessionStorage() {
            const count = sessionStorage.length;
            sessionStorage.clear();
            showStatus('sessionStorage-status', `已清空 ${count} 项 SessionStorage 数据`, 'success');
        }
        
        // Cookie 测试
        function addCookies() {
            const cookies = [
                'test-cookie-1=测试Cookie数据1',
                'test-cookie-2=测试Cookie数据2',
                'test-timestamp=' + Date.now()
            ];
            
            cookies.forEach(cookie => {
                document.cookie = cookie + '; path=/';
            });
            
            showStatus('cookies-status', `已添加 ${cookies.length} 个 Cookie`, 'success');
        }
        
        function clearCookies() {
            const cookies = document.cookie.split(';');
            let count = 0;
            
            cookies.forEach(cookie => {
                const eqPos = cookie.indexOf('=');
                const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
                if (name) {
                    document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';
                    count++;
                }
            });
            
            showStatus('cookies-status', `已尝试清空 ${count} 个 Cookie（某些 Cookie 可能需要插件清理）`, 'info');
        }
        
        // IndexedDB 测试
        async function addIndexedDB() {
            try {
                const request = indexedDB.open('TestDB', 1);
                
                request.onupgradeneeded = function(event) {
                    const db = event.target.result;
                    const objectStore = db.createObjectStore('testStore', { keyPath: 'id' });
                };
                
                request.onsuccess = function(event) {
                    const db = event.target.result;
                    const transaction = db.transaction(['testStore'], 'readwrite');
                    const objectStore = transaction.objectStore('testStore');
                    
                    const testData = [
                        { id: 1, name: 'IndexedDB 测试数据 1', timestamp: Date.now() },
                        { id: 2, name: 'IndexedDB 测试数据 2', timestamp: Date.now() }
                    ];
                    
                    testData.forEach(data => {
                        objectStore.add(data);
                    });
                    
                    showStatus('indexedDB-status', '已添加 IndexedDB 测试数据', 'success');
                };
                
                request.onerror = function() {
                    showStatus('indexedDB-status', 'IndexedDB 操作失败', 'error');
                };
            } catch (error) {
                showStatus('indexedDB-status', 'IndexedDB 不支持: ' + error.message, 'error');
            }
        }
        
        async function clearIndexedDB() {
            try {
                const databases = await indexedDB.databases();
                let count = 0;
                
                for (const db of databases) {
                    const deleteRequest = indexedDB.deleteDatabase(db.name);
                    deleteRequest.onsuccess = () => count++;
                }
                
                setTimeout(() => {
                    showStatus('indexedDB-status', `已删除 ${databases.length} 个 IndexedDB 数据库`, 'success');
                }, 1000);
            } catch (error) {
                showStatus('indexedDB-status', 'IndexedDB 清理失败: ' + error.message, 'error');
            }
        }
        
        // Cache API 测试
        async function addCacheAPI() {
            try {
                if ('caches' in window) {
                    const cache = await caches.open('test-cache-v1');
                    await cache.put('/test-url', new Response('测试缓存数据'));
                    showStatus('cacheAPI-status', '已添加 Cache API 测试数据', 'success');
                } else {
                    showStatus('cacheAPI-status', '浏览器不支持 Cache API', 'info');
                }
            } catch (error) {
                showStatus('cacheAPI-status', 'Cache API 操作失败: ' + error.message, 'error');
            }
        }
        
        async function clearCacheAPI() {
            try {
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    let count = 0;
                    
                    for (const name of cacheNames) {
                        await caches.delete(name);
                        count++;
                    }
                    
                    showStatus('cacheAPI-status', `已清空 ${count} 个 Cache`, 'success');
                } else {
                    showStatus('cacheAPI-status', '浏览器不支持 Cache API', 'info');
                }
            } catch (error) {
                showStatus('cacheAPI-status', 'Cache API 清理失败: ' + error.message, 'error');
            }
        }
        
        // 页面加载时检查存储状态
        window.addEventListener('load', checkStorage);
    </script>
</body>
</html>
